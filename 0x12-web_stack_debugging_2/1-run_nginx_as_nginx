#!/bin/bash

# Check if script is run as root
if [ "$(whoami)" != "root" ]; then
    echo "This script must be run as root."
    exit 1
fi

# Update the Nginx configuration file
NGINX_CONF="/etc/nginx/nginx.conf"

# Backup the original nginx.conf
cp $NGINX_CONF ${NGINX_CONF}.bak

# Modify the configuration to run as the nginx user and listen on port 8080
sed -i 's/^user .*/user nginx;/' $NGINX_CONF
sed -i 's/listen 80;/listen 8080;/' /etc/nginx/sites-available/default

# Ensure the necessary directories have the correct permissions
chown -R nginx:nginx /var/log/nginx /var/cache/nginx /var/run

# Restart Nginx to apply the changes
systemctl restart nginx

# Verify Nginx is running as the nginx user and listening on port 8080
ps aux | grep nginx
netstat -tulnp | grep nginx

echo "Nginx has been configured to run as the nginx user and listen on port 8080."
